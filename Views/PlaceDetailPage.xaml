<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:LezzetAtlasi.ViewModels"
             x:Class="LezzetAtlasi.Views.PlaceDetailPage"
             x:DataType="vm:PlaceDetailViewModel"
             Title="{Binding Title}">

    <ScrollView>
        <VerticalStackLayout Spacing="0">
            <!-- Images Carousel -->
            <CarouselView HeightRequest="250" ItemsSource="{Binding Place.ImageUrls}">
                <CarouselView.ItemTemplate>
                    <DataTemplate>
                        <Image Source="{Binding .}" Aspect="AspectFill" />
                    </DataTemplate>
                </CarouselView.ItemTemplate>
            </CarouselView>

            <!-- Place Info -->
            <VerticalStackLayout Padding="20" Spacing="15">
                <Label Text="{Binding Place.Name}" FontSize="28" FontAttributes="Bold" />
                
                <HorizontalStackLayout Spacing="10">
                    <Label Text="★" TextColor="Gold" FontSize="20" />
                    <Label Text="{Binding Place.AverageRating}" FontSize="18" />
                    <Label Text="{Binding Place.TotalReviews, StringFormat='({0} yorum)'}" TextColor="Gray" />
                    <Label Text="{Binding Place.PriceRange}" FontSize="18" />
                </HorizontalStackLayout>

                <Label Text="{Binding Place.Description}" TextColor="Gray" />

                <!-- Action Buttons -->
                <HorizontalStackLayout Spacing="10" Padding="0,10">
                    <Button Text="Ara" Command="{Binding CallPlaceCommand}" />
                    <Button Text="Yol Tarifi" Command="{Binding GetDirectionsCommand}" />
                    <Button Text="Paylaş" Command="{Binding SharePlaceCommand}" />
                    <Button Text="♥" Command="{Binding ToggleFavoriteCommand}" />
                </HorizontalStackLayout>

                <!-- Tabs -->
                <ScrollView Orientation="Horizontal" HeightRequest="50">
                    <HorizontalStackLayout Spacing="10">
                        <Button Text="Bilgi" Command="{Binding SelectTabCommand}" CommandParameter="Bilgi" />
                        <Button Text="Yorumlar" Command="{Binding SelectTabCommand}" CommandParameter="Yorumlar" />
                        <Button Text="Fotoğraflar" Command="{Binding SelectTabCommand}" CommandParameter="Fotoğraflar" />
                    </HorizontalStackLayout>
                </ScrollView>

                <!-- Tab Content -->
                <StackLayout IsVisible="{Binding SelectedTab, Converter={StaticResource StringEqualConverter}, ConverterParameter='Bilgi'}">
                    <Label Text="Adres:" FontAttributes="Bold" />
                    <Label Text="{Binding Place.Address}" />
                    <Label Text="Telefon:" FontAttributes="Bold" Margin="0,10,0,0" />
                    <Label Text="{Binding Place.PhoneNumber}" />
                </StackLayout>

                <!-- Reviews Tab -->
                <CollectionView ItemsSource="{Binding Reviews}"
                               IsVisible="{Binding SelectedTab, Converter={StaticResource StringEqualConverter}, ConverterParameter='Yorumlar'}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Padding="10" Margin="0,5">
                                <VerticalStackLayout Spacing="5">
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="{Binding UserName}" FontAttributes="Bold" />
                                        <Label Text="{Binding Rating, StringFormat='★ {0}'}" TextColor="Gold" />
                                    </HorizontalStackLayout>
                                    <Label Text="{Binding Comment}" />
                                    <Label Text="{Binding CreatedAt, StringFormat='{0:dd.MM.yyyy}'}" 
                                           FontSize="12" TextColor="Gray" />
                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <Button Text="Yorum Yaz" Command="{Binding WriteReviewCommand}" 
                        Margin="0,20,0,0" />
            </VerticalStackLayout>
        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
